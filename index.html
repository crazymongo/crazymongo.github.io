<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>crazymongo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="crazymongo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="crazymongo">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="crazymongo">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="crazymongo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">crazymongo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Android屏幕方向切换问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/09/Android屏幕方向切换问题/" class="article-date">
  <time datetime="2015-12-09T13:04:17.000Z" itemprop="datePublished">2015-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/09/Android屏幕方向切换问题/">Android屏幕方向切换问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在开发过程中，遇到这样一个需求：用户可以在程序中切换横竖屏，并且程序也可以按照用户在系统中设定的旋转方式进行旋转。</p>
<p>在程序中切换横竖屏的方法如下：</p>
<pre><code>setRequestedOrientation<span class="list">(<span class="keyword">ActivityInfo</span>.SCREEN_ORIENTATION_PORTRAIT)</span><span class="comment">;</span>
setRequestedOrientation<span class="list">(<span class="keyword">ActivityInfo</span>.SCREEN_ORIENTATION_LANDSCAPE)</span><span class="comment">;</span>
</code></pre><p>在用户锁定屏幕方向时，上述两个方法足以满足需求；那么问题来了，当用户没有锁定屏幕方向，而是设置成自动旋转，上述两个方法就无法满足需求了，在强制横屏后，程序就无法进行自动旋转了。于是我加了下面的代码以解决该问题：</p>
<pre><code><span class="keyword">if</span>(Settings.System.getInt(getActivity().getContentResolver(), Settings.System.ACCELEROMETER_ROTATION)==<span class="number">1</span>){
    <span class="comment">//当屏幕为自动旋转的状态下，强制横竖屏2s后，恢复页面的自动旋转        </span>
    mHandler.sendEmptyMessageDelayed(<span class="number">1</span>, <span class="number">2</span>*<span class="number">1000</span>);
}

<span class="keyword">private</span> Handler mHandler=<span class="keyword">new</span> Handler(){

    @<span class="function">Override
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>{
        <span class="keyword">switch</span>(msg.what){
        <span class="keyword">case</span> <span class="number">1</span>:
            getActivity().setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED);
            <span class="keyword">break</span>;
        }
    }
};
</code></pre><p>本以为万事大吉了，可是在使用过程中发现，如果在锁定屏幕方向的情况下，强制切换屏幕方向，然后在设置中打开自动旋转，悲剧，怎么这么多情况。于是想到了监听屏幕旋转设置状态的方法，可是找半天没有找到可用的方法。在浏览网页时，发现有人监听系统亮度改变事件，心中暗喜，哈哈，于是依葫芦画瓢，添加了如下代码：</p>
<pre><code>getContentResolver().registerContentObserver(Settings.System.getUriFor(Settings.System.ACCELEROMETER_ROTATION), <span class="keyword">true</span>, mContentObserver);

<span class="keyword">private</span> ContentObserver mContentObserver=<span class="keyword">new</span> ContentObserver(<span class="keyword">new</span> Handler()) {

    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onChange</span><span class="params">(<span class="keyword">boolean</span> selfChange)</span> </span>{
        <span class="comment">// TODO Auto-generated method stub</span>
        <span class="keyword">super</span>.onChange(selfChange);
        <span class="keyword">try</span> {
            <span class="comment">//Control whether the accelerometer will be used to change screen orientation</span>
            <span class="keyword">if</span>(Settings.System.getInt(getActivity().getContentResolver(), Settings.System.ACCELEROMETER_ROTATION)==<span class="number">1</span>){
                mHandler.sendEmptyMessageDelayed(<span class="number">1</span>, <span class="number">1000</span>);
            }
        } <span class="keyword">catch</span> (Exception e) {
            <span class="comment">// TODO Auto-generated catch block</span>
            e.printStackTrace();
        }
    }
};
</code></pre><p>到此，问题终于解决了，但是也注意到了ContentResolver这个类，我将在另外一篇文章中介绍该类。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/09/Android屏幕方向切换问题/" data-id="cii479x7d001qp8pxesolqfz8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-屏幕切换/">Android 屏幕切换</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-闭包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/09/闭包/" class="article-date">
  <time datetime="2015-12-09T03:31:00.000Z" itemprop="datePublished">2015-12-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/09/闭包/">闭包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>闭包是指可以包含自由（未绑定到特定对象）变量的代码块；这些变量不是在这个代码块内或者任何全局上下文中定义的，而是在定义代码块的环境中定义。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/09/闭包/" data-id="cii479x4g0003p8pxkntr4ao9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/闭包/">闭包</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Servlet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/20/Servlet/" class="article-date">
  <time datetime="2015-11-20T06:52:25.000Z" itemprop="datePublished">2015-11-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/20/Servlet/">Servlet</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Java Servlet是运行在Web服务器或应用服务器上的程序，它是作为来自Web浏览器或其他HTTP客户端的请求和服务器上的数据库或应用程序之间的中间层。</p>
<p>使用Servlet，可以收集来自网页表单的用户输入，呈现来自数据库或者其他源的记录，还可以动态创建网页。</p>
<p>Java Servlet通常情况下与使用CGI实现的程序可以达到异曲同工的效果。但是相比于CGI，Servlet有以下几点优势：</p>
<ul>
<li>性能明显更好</li>
<li>Servlet在Web服务器的地址空间内执行。这样它就没必要再创建一个单独的进程来处理每个客户端请求。</li>
<li>Servlet是独立于平台的，因为它们是用Java编写的。</li>
<li>服务器上的Java安全管理器执行了一系列限制，以保护服务器计算机上的资源。因此，Servlet是可信的。</li>
<li>Java类库的全部功能对Servlet来说都是可用的。它可以通过Sockets和RMI（Remote Method Invocation）机制与applets、数据库或其他软件进行交互。</li>
</ul>
<p><strong>Servlet生命周期</strong></p>
<p>Servlet声明周期可被定义为从创建直到销毁的整个过程。以下是Servlet遵循的过程：</p>
<ol>
<li>Servlet通过调用init()方法进行初始化。</li>
<li>Servlet通过调用service()方法来处理客户端的请求。</li>
<li>Servlet通过调用destory()方法终止。</li>
<li>最后，Servlet是由JVM的垃圾回收器进行垃圾回收的。</li>
</ol>
<p><strong>init() 方法</strong></p>
<p>init方法被设计成只调用一次。它在第一次创建Servlet时被调用，在后续每次用户请求时不再调用。</p>
<p>Servlet创建于用户第一次调用对应于该Servlet的URL时，但是也可以指定Servlet在服务器第一次启动时被加载。</p>
<p>当用户调用一个Servlet时，就会创建一个Servlet实例，每一个用户请求都会产生一个新的线程，适当的时候移交给doGet或doPost方法。init方法简单的创建或加载一些数据，这些数据将被用于Servlet的整个生命周期。</p>
<p>init() 方法定义如下：</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException</span>{
    <span class="comment">//初始化代码···</span>
}
</code></pre><p><strong>service()方法</strong></p>
<p>service()方法是执行实际任务的主要方法。Servlet容器（即Web服务器）调用service()方法来处理来自客户端的请求，并把格式化的响应写回给客户端。</p>
<p>每次服务器接收到一个Servlet请求时，服务器会产生一个新的线程并调用服务。service()方法检查HTTP请求类型（GET、POST、PUT、DELETE等），并在适当的时候调用doGet、doPost、doPut、doDelete等方法。</p>
<p>service()方法定义如下：</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOExcepion</span>{

}
</code></pre><p>service()方法由容器调用，service方法在适当的时候调用doGet、doPost、doPut、doDelete等方法。所以，不用对service()方法做任何动作，只需要根据来自客户端的请求类型来重载doGet() 或 doPost() 即可。</p>
<p><strong>doGet方法</strong></p>
<p>GET请求来自于一个URL的正常请求，或者来自于一个未指定METHOD的HTML表单，它由doGet()方法处理。</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span>{
    <span class="comment">//Servlet代码</span>
}
</code></pre><p><strong>doPost()方法</strong></p>
<p>POST请求来自于一个特别指定了METHOD为POST的HTML表单，它由doPost()方法处理</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException</span>{
    <span class="comment">//Servlet代码</span>
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/20/Servlet/" data-id="cii479x5f000gp8px6iwwc5v7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Servlet/">Servlet</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CGI" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/20/CGI/" class="article-date">
  <time datetime="2015-11-20T02:55:29.000Z" itemprop="datePublished">2015-11-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/20/CGI/">CGI</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CGI（Common Gateway Interface，通用网关接口）是外部应用程序（CGI程序）与Web服务器之间的接口标准，是在CGI程序和Web服务器之间传递信息的规程。CGI规范允许Web服务器执行外部程序，并将它们的输出发送给Web浏览器，CGI将Web的一组简单的静态超媒体文档变成一个完整的新的交互式媒体。</p>
<p>在物理上是一段程序，运行在服务器上，提供同客户端HTML页面的接口。举例来说：假如某个网页上有一个表单，先由用户在客户端输入一些信息，如名字之类的东西。接着用户提交表单内容，浏览器把这些信息传送到服务器的CGI目录下特定的CGI程序中，于是CGI程序在服务器上按照预定的方法进行处理。然后CGI程序给客户端发送一个信息，表示请求的任务已经结束。</p>
<p>绝大数的CGI程序被用来解释处理来自表单的输入信息，并在服务器产生相应的处理，或将相应的信息反馈给浏览器。CGI程序使网页具有交互功能。</p>
<p>处理步骤：</p>
<ol>
<li>浏览器通过网络把用户请求送到Web服务器</li>
<li>服务器接收用户请求并交给CGI程序处理</li>
<li>CGI程序把处理结果传送给web服务器</li>
<li>服务器把结果送回到用户</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/20/CGI/" data-id="cii479x7a001np8pxefqgbvpo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CGI/">CGI</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java泛型学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/02/Java泛型学习/" class="article-date">
  <time datetime="2015-11-02T02:34:13.000Z" itemprop="datePublished">2015-11-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/02/Java泛型学习/">Java泛型学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>java 泛型中? super T和? extends T的区别:</p>
<p>经常发现有List&lt;? super T&gt;、Set&lt;? extends T&gt;的声明，是什么意思？&lt;? super T&gt;表示包括T在内的任何T的父类，&lt;? extends T&gt;表示包括T在内的任何T的子类。下面让我们详细分析一下这两种通配符具体的区别。</p>
<p><strong>extends</strong></p>
<p>List&lt;? extends Number&gt; foo3的通配符声明，意味着以下的赋值是合法的：</p>
<pre><code><span class="built_in">List</span>&lt;? <span class="keyword">extends</span> Number&gt; foo3=<span class="keyword">new</span> ArrayList&lt;? <span class="keyword">extends</span> Number&gt;();
<span class="built_in">List</span>&lt;? <span class="keyword">extends</span> Number&gt; foo3=<span class="keyword">new</span> ArrayList&lt;? <span class="keyword">extends</span> Integer&gt;();
<span class="built_in">List</span>&lt;? <span class="keyword">extends</span> Number&gt; foo3=<span class="keyword">new</span> ArrayList&lt;? <span class="keyword">extends</span> Double&gt;();
</code></pre><ul>
<li>读取操作 通过以上给定的赋值语句，你一定能从foo3列表中读取到的元素的类型是什么呢？你可以读取到Number，因为以上的列表要么包含Number元素，要么包含Number的子元素。你不能保证读取到Integer，因为foo3可能指向的是List<double>。你不能保证读取到Double，因为foo3可能指向的是List<integer>.</integer></double></li>
<li>写入操作 通过以上的赋值语句，你能把一个什么类型的元素合法地插入到foo3中呢？你不能插入一个Integer元素，因为foo3可能指向List<double>。你不能插入一个Double元素，因为foo3可能指向List<integer>。你不能插入一个Number元素，因为foo3可能指向List<integer>。你不能忘List&lt;? extends T&gt;中插入任何类型的对象，因为你不能保证列表实际指向的类型是什么，你并不能保证列表中实际存储什么类型的对象。唯一可以保证的是，你可以从中读取到T或者T的子类。</integer></integer></double></li>
</ul>
<p><strong>super</strong></p>
<p>List&lt;? super Integer&gt; foo3的通配符声明，意味着以下赋值是合法的：</p>
<pre><code><span class="built_in">List</span>&lt;? supter <span class="built_in">Integer</span>&gt; foo3=<span class="literal">new</span> ArrayList&lt;<span class="built_in">Integer</span>&gt;();
<span class="built_in">List</span>&lt;? supter <span class="built_in">Integer</span>&gt; foo3=<span class="literal">new</span> ArrayList&lt;Number&gt;();
<span class="built_in">List</span>&lt;? supter <span class="built_in">Integer</span>&gt; foo3=<span class="literal">new</span> ArrayList&lt;Object&gt;();
</code></pre><ul>
<li>读取操作 通过以上给定的赋值语句，你一定能从foo3列表中读取到的元素的类型是什么呢？你不能保证读取到Integer，因为foo3可能指向List<number>或者List<object>。你不能保证读取到Number，因为foo3可能指向List<object>。唯一可以保证的是，你可以读取到Object或者Object子类的对象。</object></object></number></li>
<li>写入操作 通过以上给定的赋值语句，你能把什么类型的元素合法地插入到foo3中呢？你可以插入Integer对象，因为上述声明的列表都支持Integer。你可以插入Integer的子类的对象，因为Integer的子类同时也是Integer，原因同上。你不能插入Double对象，因为foo3可能指向ArrayList<integer>。你不能插入Number对象或者Object对象，因为foo3可能指向ArrayList<integer>。</integer></integer></li>
</ul>
<p><strong>PECS</strong></p>
<p>请记住PECS原则：生产者（Producer）使用extends，消费者（Consumer）使用super。</p>
<p>如果你需要一个列表提供T类型的元素（即你想从列表中读取T类型的元素），你需要把这个列表声明成&lt;? extends T&gt;，因此你不能往该列表中添加任何元素。</p>
<p>如果需要一个列表存储T类型的元素（即你想把T类型的元素加入到列表中），你需要把这个列表声明成&lt;? super T&gt;，因此你不能保证从中读取到的元素的类型。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/02/Java泛型学习/" data-id="cii479x5o000lp8pxgqe7kdjj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-泛型/">Java 泛型</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程技巧-对象池" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/29/编程技巧-对象池/" class="article-date">
  <time datetime="2015-10-29T06:14:49.000Z" itemprop="datePublished">2015-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/29/编程技巧-对象池/">编程技巧-对象池</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>为什么要使用对象池？</strong></p>
<p>恰当的使用对象池技术，可以有效地减少对象生成和初始化的消耗，提高系统的运行效率。</p>
<p><strong>对象池思路</strong></p>
<p>将用过的对象保存起来，等下一次需要的这种对象的时候，再拿出来重复使用，从而在一定程度上减少频繁创建对象所造成的开销。用于充当保存对象的“容器”的对象，被称为“对象池”（Object Pool，或简称Pool）</p>
<p>对于没有状态的对象，在重复使用之前，无需进行任何处理；对于有状态的对象，在重复使用之前，就需要把它们回复到等同于刚刚生成的状态。</p>
<p>并非所有的对象都适合拿来池化，因为维护对象池也要造成一定开销。对生成时开销不大的对象进行池化，反而可能会出现维护对象池的开销大于生成新对象的开销，从而使性能降低的情况。但是对于生成时开销可观的对象，池化技术就是提高性能的有效策略了。例如：线程池</p>
<p>下面是我总结的两种创建对象池的方法：</p>
<p><strong>链表思想</strong></p>
<p>下面实现了一个在链表头进行插入和删除操作的对象池的例子。</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeObject</span> </span>{
<span class="comment">//属性</span>

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_POOL_SIZE=<span class="number">50</span>; 
    <span class="keyword">private</span> <span class="keyword">static</span> SomeObject sPool;
    <span class="keyword">private</span> SomeObject next;
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> sPoolSize=<span class="number">0</span>;

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object sPoolSync=<span class="keyword">new</span> Object();

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SomeObject <span class="title">obtain</span><span class="params">()</span></span>{
        <span class="keyword">synchronized</span> (sPoolSync) {
            <span class="keyword">if</span>(sPool!=<span class="keyword">null</span>){
                SomeObject obj=sPool;
                sPool=obj.next;
                obj.next=<span class="keyword">null</span>;
                sPoolSize--;
                <span class="keyword">return</span> obj;
            }
        }
        <span class="keyword">return</span> <span class="keyword">new</span> SomeObject();
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SomeObject <span class="title">obtain</span><span class="params">(SomeObject orig)</span></span>{
        SomeObject obj=obtain();
        <span class="comment">//对象属性值复制</span>
        <span class="keyword">return</span> obj;
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recycle</span><span class="params">()</span></span>{
        clearForRecycle();
        <span class="keyword">synchronized</span> (sPoolSync) {
            <span class="keyword">if</span>(sPoolSize&lt;MAX_POOL_SIZE){
                next=sPool;
                sPool=<span class="keyword">this</span>;
                sPoolSize++;
            }
        }
    }

    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clearForRecycle</span><span class="params">()</span></span>{
        <span class="comment">//重置属性</span>
    }

}
</code></pre><p><strong>通过ArrayList实现</strong></p>
<pre><code><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PendingPost</span> {
    <span class="keyword">private</span> final <span class="keyword">static</span> List&lt;PendingPost&gt; pendingPostPool = <span class="keyword">new</span> ArrayList&lt;PendingPost&gt;();

    Object <span class="keyword">event</span>;
    Subscription subscription;

    <span class="function"><span class="keyword">private</span> <span class="title">PendingPost</span>(<span class="params">Object <span class="keyword">event</span>, Subscription subscription</span>) </span>{
        <span class="keyword">this</span>.<span class="keyword">event</span> = <span class="keyword">event</span>;
        <span class="keyword">this</span>.subscription = subscription;
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PendingPost <span class="title">obtainPendingPost</span>(<span class="params">Subscription subscription, Object <span class="keyword">event</span></span>) </span>{
        synchronized (pendingPostPool) {
            <span class="keyword">int</span> size = pendingPostPool.size();
            <span class="keyword">if</span> (size &gt; <span class="number">0</span>) {
                PendingPost pendingPost = pendingPostPool.remove(size - <span class="number">1</span>);
                pendingPost.<span class="keyword">event</span> = <span class="keyword">event</span>;
                pendingPost.subscription = subscription;
                <span class="keyword">return</span> pendingPost;
            }
        }
        <span class="keyword">return</span> <span class="keyword">new</span> PendingPost(<span class="keyword">event</span>, subscription);
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">releasePendingPost</span>(<span class="params">PendingPost pendingPost</span>) </span>{
        pendingPost.<span class="keyword">event</span> = <span class="keyword">null</span>;
        pendingPost.subscription = <span class="keyword">null</span>;
        synchronized (pendingPostPool) {
            <span class="comment">// Don't let the pool grow indefinitely</span>
            <span class="keyword">if</span> (pendingPostPool.size() &lt; <span class="number">10000</span>) {
                pendingPostPool.add(pendingPost);
            }
        }
    }

}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/10/29/编程技巧-对象池/" data-id="cii479x570009p8pxpld12ciy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编程技巧-对象池/">编程技巧 对象池</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-EventBus学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/29/EventBus学习笔记/" class="article-date">
  <time datetime="2015-10-29T02:48:02.000Z" itemprop="datePublished">2015-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/29/EventBus学习笔记/">EventBus学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>当我们通过调用EventBus.register()方法来注册某个类时，EventBus内部执行过程如下：</p>
<ol>
<li>通过SubscriberMethodFinder类的findSubscriberMethods方法找出注册类中所有的以onEvent开头、修饰符为public、并且只有一个参数的方法，并将这些方法封装成SubscriberMethod对象存储在一个数组列表中。</li>
<li>循环步骤1得到的列表，根据每个方法所处理的事件封装成不同的Subscription对象。EventBus内部依据事件类型，构建了一个名为subscriptionsByEventType的HashMap，这个HashMap以事件为键，将一个CopyOnWriteArrayList的列表作为值，这个列表中存储不同Subsriber中处理某个相同事件的方法，及Subscription对象。最后根据Subscription的优先级不同，将Subscription放在列表中不同的位置。EventBus内部还维护一个名为typesBySubscriber的HashMap，该HashMap用来保存某个注册类中所有能够处理的事件。</li>
</ol>
<p>当我们通过调用EventBus.unregister()方法来注销某个类时，EventBus内部执行过程如下：</p>
<ol>
<li>从HashMap typesBySubscriber中得到类所有订阅的事件类型列表</li>
<li>循环该列表，根据每个事件，从HashMap subscriptionsByEventType中获取处理该事件的订阅列表，循环列表，从中移除属于注销类的订阅。</li>
<li>最后从HashMap typesBySubscriber中移除该订阅者。</li>
</ol>
<p>当调用EventBus.post()方法来发布一个事件时，其内部流程如下：</p>
<ol>
<li>事件被放入PostingThreadState对象中的一个数组列表中。</li>
<li>判断EventBus对象当前是否处于主线程。</li>
<li>循环PostingThreadState对象中的事件列表，准备发布事件</li>
<li>根据事件类型，获取之前的订阅列表。</li>
<li>根据订阅方法的线程模式，调用订阅方法。</li>
</ol>
<p>每个订阅方法的线程模式分析：</p>
<pre><code>EventBus有4个线程模式：

-<span class="ruby"> <span class="constant">PostThread</span> 以onEvent作为方法名，订阅方法在产生事件的线程中被调用
</span>-<span class="ruby"> <span class="constant">MainThread</span> 以onEventMainThread作为方法名，订阅方法在主线程中被调用
</span>-<span class="ruby"> <span class="constant">BackgroudThread</span> 以onEventBackgroudThread作为方法名，订阅方法在后台线程中被调用
</span>-<span class="ruby"> <span class="constant">Async</span> 以onEventAsync作为方法名，订阅方法在后台线程中被调用</span>
</code></pre><p>如果是PostThread模式，订阅方法将会直接被调用执行。</p>
<p>如果是MainThread模式，且事件是在主线程中产生的，则订阅方法将会直接被调用执行；若事件不在主线程中产生，将通过HandlerPoster对象调用订阅方法。</p>
<p>如果是BackgroudThread模式，且事件是在主线程中产生的，将通过BackgroundPoster对象调用订阅方法；若事件不在主线程中产生，直接调用订阅方法。</p>
<p>如果是Async模式，无论事件在什么线程中产生，都将通过AsyncPoster对象调用订阅方法。</p>
<p>HandlerPoster类继承了Handler,里面包含一个保存订阅方法的队列，在handleMessage方法中循环该队列，调用订阅方法。</p>
<p>BackgroundPoster和AsyncPoster都实现了Runnable方法，区别在于AsyncPoster只有在订阅进队时才执行，执行结束就跳出run方法，而BackgroundPoster可能会一直在run方法中运行。</p>
<p>EventBus的eventInheritance属性分析：</p>
<p>默认为true，个人认为这是事件连带机制，也就是说，如果事件A，继承了事件B、C等，若事件A发生，则事件B、C也会连带发生。</p>
<p>EventBus粘性事件，及StickyEvent分析：</p>
<p>当调用postSticky(SomeEvent event)方法时，被传递的事件event先被保存在内存中，然后调用普通的post方法。当用户使用registerSticky方法注册时，如果注册者里面包含处理某些处理粘性事件的方法时，这些方法将会被执行。</p>
<p>此外，EventBus还支持高优先级的订阅者取消事件的传递，粘性事件的移除等。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/10/29/EventBus学习笔记/" data-id="cii479x75001kp8px00jcimei" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-EventBus/">android EventBus</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java-Future" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/20/Java-Future/" class="article-date">
  <time datetime="2015-10-20T08:15:52.000Z" itemprop="datePublished">2015-10-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/Java-Future/">Java-Future</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Future表示异步计算的结果。它提供了检查计算是否完成的方法，以等待计算的完成，并获取计算的结果。计算完成后只能使用get方法来获取结果，如果有必要，计算完成前可以阻塞此方法。取消则由cancel方法来执行。还提供了其他方法，以确定任务是正常完成还是被取消了。一旦计算完成，就不能再取消计算。如果为了可取消性而使用Future但又不提供可用的结果，则可以声明Future&lt;?&gt; 形式类型、并返回null作为底层任务的结果。</p>
<p>RunnableFuture是一个作为Runnable的Future。成功执行run方法可以完成Future并允许访问其结果。其定义如下：</p>
<pre><code>public <span class="keyword">interface</span> <span class="type">RunnableFuture</span>&lt;V&gt; extends <span class="type">Runnable</span>, <span class="type">Future</span>&lt;V&gt; {
    /**
     * <span class="type">Sets</span> this <span class="type">Future</span> to the <span class="literal">result</span> <span class="keyword">of</span> its computation
     * unless it has been cancelled.
     */
    <span class="type">void</span> run();
}
</code></pre><p>FutureTask类是RunnableFuture的一个实现，是可取消的异步计算。利用开始和取消计算的方法、查询计算是否完成的方法和获取计算结果的方法，此类提供了对Future的基本实现。仅在计算完成时才能获取结果；如果计算尚未完成，则阻塞get方法。一旦计算完成，就不能再重新开始或取消计算。</p>
<p>可使用FutureTask包装Callable或Runnable对象。因为FutureTask实现了Runnable，所以可将FutureTask提交给Executor执行。</p>
<p>除了作为一个独立的类型，此类还提供了protected功能，这在创建自定义任务类时可能很有用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/10/20/Java-Future/" data-id="cii479x69000pp8pxqo4l6ux1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-Future/">Java Future</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java-Callable" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/20/Java-Callable/" class="article-date">
  <time datetime="2015-10-20T07:38:49.000Z" itemprop="datePublished">2015-10-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/Java-Callable/">Java-Callable</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Callable是一个可以返回结果或者抛出异常的可执行任务。实现者在该接口中唯一定义了一个叫做call的无参方法。</p>
<p>Callable接口类似于Runnable，两者都是为那些其实例可能被另外一个线程执行的类设计的。但是Runnable不会返回结果，并且无法抛出经过检查的异常。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/10/20/Java-Callable/" data-id="cii479x6v001ap8px1ysq50ue" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-Callable/">Java Callable</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java-ExecutorService" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/10/20/Java-ExecutorService/" class="article-date">
  <time datetime="2015-10-20T06:56:23.000Z" itemprop="datePublished">2015-10-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/20/Java-ExecutorService/">Java-ExecutorService</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ExecutorService提供管理终止的方法，以及可以跟踪一个或多个异步任务执行状况，并生产Future对象的方法。</p>
<p>ExecutorService可以被关闭，这将导致其拒绝新任务。其提供了两种不同的方法来关闭自身。shutdown()方法在终止前允许执行以前提交的任务，而shutdownNow()方法阻止等待任务启动并试图停止当前正在执行的任务。在终止时，执行程序没有任务在执行，也没有任务在等待执行，并且无法提交新任务。应当关闭未使用的ExecutorService以允许回收其资源。</p>
<p>通过创建并返回一个可用于取消执行和/或等待完成的Future对象，submit方法扩展了基本方法execute。方法invokeAny和invokeAll是批量执行的最常用形式，它们执行任务collection，然后等待至少一个，或全部任务完成（可使用ExecutorCompletionService类来编写这些方法的自定义变体）。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/10/20/Java-ExecutorService/" data-id="cii479x6h000vp8pxjzd9qrcr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java-ExecutorService/">Java ExecutorService</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Handler/">Android Handler</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Message/">Android Message</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Messenger/">Android Messenger</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-屏幕切换/">Android 屏幕切换</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AndroidStudio-Gradle/">AndroidStudio Gradle</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CGI/">CGI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-ByteArrayOutputStream/">Java ByteArrayOutputStream</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Callable/">Java Callable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Closeable-Flushable/">Java Closeable Flushable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-DataOutput/">Java DataOutput</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Executor/">Java Executor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-ExecutorService/">Java ExecutorService</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-FilterOutputStream/">Java FilterOutputStream</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-Future/">Java Future</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java-泛型/">Java 泛型</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Servlet/">Servlet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-EventBus/">android EventBus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/classloader/">classloader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-DataInput/">java DataInput</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-线程池/">java 线程池</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式-负载均衡算法/">分布式 负载均衡算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编程技巧-对象池/">编程技巧 对象池</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/闭包/">闭包</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android-Handler/" style="font-size: 10px;">Android Handler</a> <a href="/tags/Android-Message/" style="font-size: 10px;">Android Message</a> <a href="/tags/Android-Messenger/" style="font-size: 10px;">Android Messenger</a> <a href="/tags/Android-屏幕切换/" style="font-size: 10px;">Android 屏幕切换</a> <a href="/tags/AndroidStudio-Gradle/" style="font-size: 10px;">AndroidStudio Gradle</a> <a href="/tags/CGI/" style="font-size: 10px;">CGI</a> <a href="/tags/Java-ByteArrayOutputStream/" style="font-size: 10px;">Java ByteArrayOutputStream</a> <a href="/tags/Java-Callable/" style="font-size: 10px;">Java Callable</a> <a href="/tags/Java-Closeable-Flushable/" style="font-size: 10px;">Java Closeable Flushable</a> <a href="/tags/Java-DataOutput/" style="font-size: 10px;">Java DataOutput</a> <a href="/tags/Java-Executor/" style="font-size: 10px;">Java Executor</a> <a href="/tags/Java-ExecutorService/" style="font-size: 10px;">Java ExecutorService</a> <a href="/tags/Java-FilterOutputStream/" style="font-size: 10px;">Java FilterOutputStream</a> <a href="/tags/Java-Future/" style="font-size: 10px;">Java Future</a> <a href="/tags/Java-泛型/" style="font-size: 10px;">Java 泛型</a> <a href="/tags/Servlet/" style="font-size: 10px;">Servlet</a> <a href="/tags/android-EventBus/" style="font-size: 10px;">android EventBus</a> <a href="/tags/classloader/" style="font-size: 10px;">classloader</a> <a href="/tags/java-DataInput/" style="font-size: 10px;">java DataInput</a> <a href="/tags/java-线程池/" style="font-size: 10px;">java 线程池</a> <a href="/tags/分布式-负载均衡算法/" style="font-size: 10px;">分布式 负载均衡算法</a> <a href="/tags/编程技巧-对象池/" style="font-size: 10px;">编程技巧 对象池</a> <a href="/tags/闭包/" style="font-size: 10px;">闭包</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/12/09/Android屏幕方向切换问题/">Android屏幕方向切换问题</a>
          </li>
        
          <li>
            <a href="/2015/12/09/闭包/">闭包</a>
          </li>
        
          <li>
            <a href="/2015/11/20/Servlet/">Servlet</a>
          </li>
        
          <li>
            <a href="/2015/11/20/CGI/">CGI</a>
          </li>
        
          <li>
            <a href="/2015/11/02/Java泛型学习/">Java泛型学习</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 crazymongo<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>